{% extends "base.html" %}
{% block content %}

<h1>🛠 인프라 시트 조회 
    <button type="button" style="float: right;" onclick="location.href='/main'">🏠 메인으로</button>
</h1>

<form method="get" action="/infra" class="search-form">

    <fieldset style="display:flex; flex-wrap: wrap; gap: 15px;">
        <legend>📌 시트 선택</legend>
        {% for label in sheet_options %}
        <label>
            <input type="checkbox" name="selected_sheets" value="{{ label }}"
                   {% if label == "전월 무선가동점" or label in selected_sheets %}checked{% endif %}
                   onclick="handleCheckboxClick(this)">
            {{ label }}
        </label>
        {% endfor %}
    </fieldset>

    <div class="search-form" style="margin-top: 20px; display: flex; gap: 10px;">
        <select name="filter_column">
            <option value="사번" {% if filter_column == "사번" %}selected{% endif %}>사번</option> 
            <option value="지사" {% if filter_column == "지사" %}selected{% endif %}>지사</option>
            <option value="센터" {% if filter_column == "센터" %}selected{% endif %}>센터</option>
            <option value="접점코드" {% if filter_column == "접점코드" %}selected{% endif %}>접점코드</option>
        </select>
        <input type="text" name="filter_value" placeholder="검색어 입력" value="{{ filter_value or '' }}">
        <button type="submit">🔍 검색</button>
    </div>

</form>

<hr>

{% if tables %}
    {% for label, html in tables.items() %}
        <h2 style="margin-top: 40px;">📄 {{ label }}</h2>
        <div class="table-wrapper">
            <div class="table-container">
                {{ html | safe }}
            </div>
        </div>
    {% endfor %}
{% else %}
    <p style="margin-top: 30px;">✅ 시트를 선택하고 검색어를 입력해 결과를 확인하세요.</p>
{% endif %}

<script>
// ✅ 체크박스 클릭 시 다른 체크박스 자동 해제
function handleCheckboxClick(clicked) {
    document.querySelectorAll('input[name="selected_sheets"]').forEach(checkbox => {
        if (checkbox !== clicked) checkbox.checked = false;
    });
}
</script>

<style>
.meta-count {
    font-weight: normal;
    color: #666;
    margin-left: 10px;
}
.meta-separator {
    border-top: 1px solid #ccc;
    margin: 10px 0;
}
.reply-separator {
    border-top: 1px solid #ddd;
    margin: 14px 0;
}
.text {
    white-space: pre-wrap;
    font-size: 30px;
}
.reply-list .reply {
    padding-left: 1em;
    position: relative;
    font-weight: bold;
}
.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
/* ✅ 사번/이름 컬럼 자동 숨김 */
.table-container table th:nth-child(1),
.table-container table td:nth-child(1),
.table-container table th:nth-child(2),
.table-container table td:nth-child(2) {
    display: none;
}
</style>

{% endblock %}
