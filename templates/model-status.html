{% extends "base.html" %}

{% block content %}
<div class="header-row">
    <h1>ğŸ“¦ ëª¨ë¸ë³„ í˜„í™©</h1>
    <a href="/main"><button type="button" class="main-button">ğŸ  ë©”ì¸ìœ¼ë¡œ</button></a>
</div>

<form method="get" action="/model-status" class="search-form">
    <div class="search-top-section">
        <div class="search-grid">
            <div class="search-left">
                <select name="search_field">
                    <option value="ì‚¬ë²ˆ" {% if search_field in [None, '', 'ì‚¬ë²ˆ'] %}selected{% endif %}>ì‚¬ë²ˆ</option>
                    <option value="ì§€ì‚¬" {% if search_field == "ì§€ì‚¬" %}selected{% endif %}>ì§€ì‚¬</option>
                    <option value="ì„¼í„°" {% if search_field == "ì„¼í„°" %}selected{% endif %}>ì„¼í„°</option>
                    <option value="ì ‘ì ì½”ë“œ" {% if search_field == "ì ‘ì ì½”ë“œ" %}selected{% endif %}>ì ‘ì ì½”ë“œ</option>
                </select>

                <input type="text" name="search_value" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" value="{{ search_value or '' }}">
            </div>

            <div class="search-right">
                <div class="filter-method-box">
                    <label><input type="radio" name="filter_mode" value="text" checked onchange="toggleFilterMode('text')"> ëª¨ë¸ëª… ê²€ìƒ‰</label>
                    <input type="text" id="model_text" name="model_text" placeholder="ì˜ˆ: S25" value="{{ model_text or '' }}">
                </div>

                <div class="filter-method-box model-select-container">
                    <label><input type="radio" name="filter_mode" value="select" onchange="toggleFilterMode('select')"> ëª¨ë¸ ë‹¤ì¤‘ì„ íƒ</label>
                    <select name="model_list" id="model_list" multiple size="7" disabled>
                        {% for model in model_options %}
                            <option value="{{ model }}" {% if model in selected_models %}selected{% endif %}>{{ model }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="reset-button-inline" onclick="resetModelSelection()" disabled>ì²´í¬í•´ì œ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="search-actions">
        <button type="submit" name="exclude_branch" value="false" class="search-button">ğŸ” ê²€ìƒ‰í•˜ê¸°</button>
        <button type="submit" name="exclude_branch" value="true" class="search-button">ğŸ” ê²€ìƒ‰í•˜ê¸°(ì ‘ì ì œì™¸)</button>
    </div>
</form>

<hr>

{% if table_html %}
    <div id="table-wrapper" class="table-scroll {% if request.query_params.get('exclude_branch') == 'true' %}exclude-branch{% else %}exclude-none{% endif %}">
        {{ table_html | safe }}
    </div>
{% else %}
    <p class="large-text">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}

<script>
function resetModelSelection() {
    const selectBox = document.getElementById("model_list");
    for (let i = 0; i < selectBox.options.length; i++) {
        selectBox.options[i].selected = false;
    }
}

function toggleFilterMode(mode) {
    const modelTextInput = document.getElementById("model_text");
    const modelList = document.getElementById("model_list");
    const resetBtn = document.querySelector(".reset-button-inline");

    if (mode === 'text') {
        modelTextInput.disabled = false;
        modelList.disabled = true;
        resetBtn.disabled = true;
    } else {
        modelTextInput.disabled = true;
        modelList.disabled = false;
        resetBtn.disabled = false;
    }
}
</script>

<style>
/* âœ… ì‚¬ë²ˆ / ì´ë¦„ ìˆ¨ê¹€: ê²€ìƒ‰í•˜ê¸° ë²„íŠ¼ì¼ ê²½ìš°ë§Œ */
#table-wrapper.exclude-none th:contains("ì‚¬ë²ˆ"),
#table-wrapper.exclude-none td:nth-child(1),
#table-wrapper.exclude-none th:contains("ì´ë¦„"),
#table-wrapper.exclude-none td:nth-child(2) {
    display: none;
}

/* ì ‘ì ì œì™¸ì¼ ê²½ìš°: ì ‘ì ì½”ë“œ / ì ‘ì ëª… ìˆ¨ê¹€ */
#table-wrapper.exclude-branch th:contains("ì ‘ì ì½”ë“œ"),
#table-wrapper.exclude-branch td:nth-child(5),
#table-wrapper.exclude-branch th:contains("ì ‘ì ëª…"),
#table-wrapper.exclude-branch td:nth-child(6) {
    display: none;
}

/* âœ… í•©ê³„ í–‰ ìŠ¤íƒ€ì¼ */
.summary-row td {
    background-color: #eaf6ff !important;
    font-weight: bold;
}

body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    overflow-x: hidden;
}

.header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 10px;
}

.main-button {
    font-size: 24px;
    padding: 12px 20px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    cursor: pointer;
}

.search-form {
    width: 100%;
    font-size: 24px;
    box-sizing: border-box;
    padding: 0 10px;
}

.search-top-section {
    width: 100%;
}

.search-grid {
    display: flex;
    flex-direction: row;
    gap: 20px;
    flex-wrap: wrap;
    width: 100%;
}

.search-left {
    flex: 1;
    min-width: 260px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.search-left select,
.search-left input[type="text"] {
    width: 100%;
    padding: 10px;
    font-size: 24px;
    box-sizing: border-box;
}

.search-right {
    flex: 2;
    display: flex;
    flex-direction: column;
    gap: 16px;
    min-width: 300px;
}

.filter-method-box {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.filter-method-box input[type="text"] {
    flex: 1;
    padding: 10px;
    font-size: 24px;
    width: 100%;
    box-sizing: border-box;
}

.model-select-container {
    flex-wrap: nowrap;
}

.model-select-container select {
    flex: 5;
    padding: 12px;
    font-size: 24px;
}

.reset-button-inline {
    margin-left: 8px;
    font-size: 20px;
    padding: 12px;
    height: 100%;
    white-space: nowrap;
}

.search-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    flex-direction: column;
}

.search-button {
    padding: 12px;
    font-size: 24px;
    width: 100%;
    background-color: #007BFF;
    color: white;
    border: none;
    cursor: pointer;
}

.search-button.gray {
    background-color: #6c757d;
}

.table-scroll {
    overflow-x: auto;
    width: 100%;
}

.table {
    min-width: 800px;
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 24px;
}

.table th, .table td {
    border: 1px solid #ccc;
    padding: 2px 8px;
    text-align: center;
}

.table th {
    background-color: #f2f2f2;
}

@media (max-width: 768px) {
    .search-grid {
        flex-direction: column;
    }
    .reset-button-inline {
        width: 100%;
    }
    .header-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    .main-button {
        width: 100%;
    }
    .search-actions {
        flex-direction: column;
    }
}
</style>
{% endblock %}
