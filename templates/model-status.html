{% extends "base.html" %}

{% block content %}
<div class="header-row">
    <h1>ğŸ“± ëª¨ë¸ë³„ í˜„í™©</h1>
    <div class="top-right-button">
        <a href="/main"><button type="button" class="main-button">ğŸ  ë©”ì¸ìœ¼ë¡œ</button></a>
    </div>
</div>

<form method="get" action="/model-status" class="search-form">
    <div class="search-top-section">
        <div class="search-paired-grid">
            <div class="pair-column">
                <select name="search_field">
                    <option value="ì‚¬ë²ˆ" {% if search_field in [None, '', 'ì‚¬ë²ˆ'] %}selected{% endif %}>ì‚¬ë²ˆ</option>
                    <option value="ì§€ì‚¬" {% if search_field == "ì§€ì‚¬" %}selected{% endif %}>ì§€ì‚¬</option>
                    <option value="ì„¼í„°" {% if search_field == "ì„¼í„°" %}selected{% endif %}>ì„¼í„°</option>
                    <option value="ì ‘ì ì½”ë“œ" {% if search_field == "ì ‘ì ì½”ë“œ" %}selected{% endif %}>ì ‘ì ì½”ë“œ</option>
                </select>
                <input type="text" name="search_value" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" value="{{ search_value or '' }}">
            </div>
            <div class="pair-column">
                <div class="filter-method-box">
                    <label><input type="radio" name="filter_mode" value="text" checked onchange="toggleFilterMode('text')"> ëª¨ë¸ëª… ê²€ìƒ‰</label>
                    <input type="text" id="model_text" name="model_text" placeholder="ì˜ˆ: S25" value="{{ model_text or '' }}">
                </div>
                <div class="filter-method-box model-select-container">
                    <label><input type="radio" name="filter_mode" value="select" onchange="toggleFilterMode('select')"> ëª¨ë¸ ë‹¤ì¤‘ì„ íƒ</label>
                    <div style="display: flex; align-items: flex-start; gap: 8px;">
                        <select name="model_list" id="model_list" multiple size="7" disabled style="flex: 1 1 80%;">
                            {% for model in model_options %}
                                <option value="{{ model }}" {% if model in selected_models %}selected{% endif %}>{{ model }}</option>
                            {% endfor %}
                        </select>
                        <button type="button" class="reset-button-inline" onclick="resetModelSelection()" disabled>ì²´í¬í•´ì œ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="search-actions horizontal-buttons">
        <button type="submit" name="exclude_branch" value="false" class="search-button"> 1ï¸âƒ£ê²€ìƒ‰</button>
        <button type="submit" name="exclude_branch" value="true" class="search-button">2ï¸âƒ£ ê²€ìƒ‰(ì ‘ì ì œì™¸)</button>
        <button type="submit" name="exclude_center" value="true" class="search-button">3ï¸âƒ£ ê²€ìƒ‰(ì„¼í„°,ì ‘ì ì œì™¸)</button>
    </div>
</form>

<hr>

{% if table_html %}
    <div id="table-wrapper" class="table-scroll {% if request.query_params.get('exclude_center') == 'true' %}exclude-center{% elif request.query_params.get('exclude_branch') == 'true' %}exclude-branch{% else %}exclude-none{% endif %}">
        {{ table_html | safe }}
    </div>
{% else %}
    <p class="large-text">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}

<script>
function resetModelSelection() {
    const selectBox = document.getElementById("model_list");
    for (let i = 0; i < selectBox.options.length; i++) {
        selectBox.options[i].selected = false;
    }
}

function toggleFilterMode(mode) {
    const modelTextInput = document.getElementById("model_text");
    const modelList = document.getElementById("model_list");
    const resetBtn = document.querySelector(".reset-button-inline");

    if (mode === 'text') {
        modelTextInput.disabled = false;
        modelList.disabled = true;
        resetBtn.disabled = true;
    } else {
        modelTextInput.disabled = true;
        modelList.disabled = false;
        resetBtn.disabled = false;
    }
}
</script>

<style>
.header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 10px;
}

.top-right-button {
    margin-left: auto;
}

.search-paired-grid {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
}

.pair-column {
    flex: 1;
    min-width: 280px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.search-actions.horizontal-buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin-top: 10px;
}

.search-actions.horizontal-buttons .search-button {
    width: 32%;
    min-width: 100px;
    font-size: 22px;
    padding: 12px;
    margin: 0;
    box-sizing: border-box;
    background-color: #0003a4;
    color: #fff !important;
}

/* âœ… ì ‘ì  ê´€ë ¨ ì»¬ëŸ¼ ìˆ¨ê¸°ê¸° (ì„¼í„°,ì ‘ì ì œì™¸ì¼ ë•Œ) */
#table-wrapper.exclude-center th:nth-child(3),
#table-wrapper.exclude-center td:nth-child(3),
#table-wrapper.exclude-center th:nth-child(4),
#table-wrapper.exclude-center td:nth-child(4) {
    display: none;
}

@media (max-width: 768px) {
    .search-actions.horizontal-buttons {
        flex-direction: column;
    }

    .search-actions.horizontal-buttons .search-button {
        width: 100%;
        margin-bottom: 8px;
    }
}
</style>
{% endblock %}
