dashboard

{% extends "base.html" %}
{% block content %}
{% set type = type or "ì¢…í•©" %}

<style>
.dashboard-wrapper {
    position: sticky;
    top: 0;
    background-color: #fff;
    z-index: 10;
    padding: 12px;
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.dashboard-title {
    font-size: 32px;
    font-weight: 1200;
}

.dashboard-header a button {
    font-size: 32px;
    font-weight: 600;
    padding: 16px 24px;
}

.form-section {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 12px;
    width: 100%;
}

.form-section select,
.form-section input[type="text"],
.form-section button {
    font-size: 28px;
    font-weight: 600;
    padding: 16px;
    flex: 1;
    min-width: 0;
}

.fieldset-group {
    display: flex;
    flex-wrap: nowrap;
    gap: 8px;
    overflow-x: auto;
    margin-bottom: 16px;
}

fieldset {
    flex: 1;
    min-width: auto;
    border: 2px solid #999;
    padding: 8px;
    border-radius: 8px;
    background-color: #fff;
    white-space: nowrap;
}

fieldset legend {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 4px;
    border-bottom: 1px solid #ccc;
}

.fieldset-group label {
    display: flex;
    align-items: center;
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 4px;
}

.fieldset-group input[type="checkbox"] {
    transform: scale(1.6);
    margin-right: 6px;
}

.dashboard-table-wrapper a {
    overflow-x: auto;
    width: 100%;
    color: rgb(32, 9, 243);
    text-decoration: none;
    font-weight: 600;
}

.table-wrapper {
    overflow-x: auto;
    width: 100%;
    margin-left: 0;  /* ì¶”ê°€ */
}

.table {
    width: auto;
    border-collapse: collapse;
    table-layout: auto;
}

.table th, .table td {
    font-size: 20px;
    font-weight: 600;
    padding: 4px 8px;
    vertical-align: middle;
    white-space: nowrap;
    color: #111;
    border: 1px solid #b9b6b6;
    background-clip: padding-box;
    text-align: center;
}

.table th {
    background-color: var(--orange);
    color: rgb(0, 0, 0);
    z-index: 5;
}

.table tr:first-child td {
    background-color: #e0f7ff !important;
}

.hidden-col {
    visibility: hidden !important;
    pointer-events: none !important;
}

.sabun-col, .name-col {
    min-width: 80px;
    max-width: 80px;
    width: 80px;
}

.sort-bar {
    margin-bottom: 12px;
    width: 100%;
    display: flex;
    justify-content: flex-start;
}
.sort-inline {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    flex-wrap: nowrap;
    width: 50%;
    justify-content: space-between;
}
.sort-inline label {
    flex: 0;
    white-space: nowrap;
    font-size: 22px;
    box-sizing: border-box;
    padding: 6px 8px;
}
.sort-inline select {
    flex: 1;
    font-size: 20px;
    min-width: 120px;
    padding: 10px 12px;
}
.sort-inline button {
    flex: 1;
    text-align: center;
    font-size: 18px;
    padding: 6px 8px;
    white-space: nowrap;
    box-sizing: border-box;
}
.sort-inline button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    font-weight: 600;
}
.toggle-columns-btn {
    background-color: #e53935;
    color: white;
    font-size: 18px;
    font-weight: bold;
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
.toggle-columns-btn:hover {
    background-color: #c62828;
}
</style>

<div class="dashboard-wrapper">
    <div class="dashboard-header">
        <div class="dashboard-title">ğŸ“Š ìœ ë¬´ì„  ì¢…í•© í˜„í™© </div>
        <a href="/main"><button>ğŸ  ë©”ì¸ìœ¼ë¡œ</button></a>
    </div>

    <form method="get" action="/dashboard">
        <input type="hidden" name="type" value="{{ type or 'ì¢…í•©' }}">
        <div class="form-section">
            <select name="search_column">
                <option value="ì‚¬ë²ˆ" {% if search_column == 'ì‚¬ë²ˆ' %}selected{% endif %}>ì‚¬ë²ˆ</option>
                <option value="ì§€ì‚¬" {% if search_column == 'ì§€ì‚¬' %}selected{% endif %}>ì§€ì‚¬</option>
                <option value="ì„¼í„°" {% if search_column == 'ì„¼í„°' %}selected{% endif %}>ì„¼í„°</option>
                <option value="ì ‘ì ì½”ë“œ" {% if search_column == 'ì ‘ì ì½”ë“œ' %}selected{% endif %}>ì ‘ì ì½”ë“œ</option>
            </select>

            <input type="text" name="search_value" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" value="{{ search_value or '' }}">
            <button type="submit">ğŸ” ê²€ìƒ‰í•˜ê¸°</button>
            <button type="button" onclick="uncheckAll()">ğŸ”„ ì²´í¬ í•´ì œ</button>
        </div>

        <div class="fieldset-group">
            {% for group in [
                ["âœ… ë¬´ì„ ", ["ì¼ë°˜í›„ë¶ˆ", "010", "MNP", "ê¸°ë³€", "ì¤‘ê³ ", "5G", "3G/LTE"]],
                ["âœ… ë¬´ì„  ê¸°íƒ€", ["100Kì´ìƒ", "ì´ˆì´ìŠ¤4ì¢…", "S25", "AIP16"]],
                ["â˜‘ï¸ ìœ ì„ ", [("ìœ ì„ ì‹ ê·œ I+T", "ì‹ ê·œ I+T"), ("ìœ ì„ ì‹ ê·œ I", "ì‹ ê·œ I"), ("ìœ ì„ ì‹ ê·œ T", "ì‹ ê·œ T"),
                           ("ìœ ì„ ì•½ê°± I+T", "ì•½ê°± I+T"), ("ìœ ì„ ì•½ê°± I", "ì•½ê°± I"), ("ìœ ì„ ì•½ê°± T", "ì•½ê°± T")]],
                ["â˜‘ï¸ MIT(M)", [("MIT(M) í•©ê³„", "í•©ê³„"), ("MIT(M) ì‹ ê·œ", "ì‹ ê·œ"), ("MIT(M) ì•½ê°±", "ì•½ê°±")]],
                ["â˜‘ï¸ MIT(I)", [("MIT(I) í•©ê³„", "í•©ê³„"), ("MIT(I) ì‹ ê·œ", "ì‹ ê·œ"), ("MIT(I) ì•½ê°±", "ì•½ê°±"), ("ì‹ ë™", "ì‹ ë™"), ("ì‹ ë™ëª¨ìˆ˜", "ì‹ ë™ëª¨ìˆ˜"), ("ì‹ ë™ë¥ ", "ì‹ ë™ë¥ ")]],
                ["âœ”ï¸ ìµœê·¼ 3ê°œì›”", ["ì¼ë°˜í›„ë¶ˆ(M,ëŒ€)", "ìœ ì„ ì‹ ê·œ(M,ëŒ€)"]]
            ] %}
            <fieldset>
                <legend>{{ group[0] }}</legend>
                {% for col in group[1] %}
                    {% if col is string %}
                        <label><input type="checkbox" name="columns" value="{{ col }}" {% if col in columns %}checked{% endif %}> {{ col }}</label>
                    {% else %}
                        <label><input type="checkbox" name="columns" value="{{ col[0] }}" {% if col[0] in columns %}checked{% endif %}> {{ col[1] }}</label>
                    {% endif %}
                {% endfor %}
            </fieldset>
            {% endfor %}
        </div>
    </form>

    <hr>

    {% if table_html %}
    <div class="sort-bar">
        <form method="get" action="/dashboard" class="sort-inline">
            <input type="hidden" name="type" value="{{ type }}">
            <input type="hidden" name="search_column" value="{{ search_column }}">
            <input type="hidden" name="search_value" value="{{ search_value }}">
            {% for col in columns %}
            <input type="hidden" name="columns" value="{{ col }}">
            {% endfor %}

            <label>ğŸ”” ì •ë ¬ê¸°ì¤€</label>

            <select name="sort_column">
                {% for col in columns %}
                    <option value="{{ col }}" {% if col == sort_column %}selected{% endif %}>{{ col }}</option>
                {% endfor %}
            </select>

            <button type="submit" name="sort_order" value="asc">ğŸ”¼<span>ì˜¤ë¦„ì°¨ìˆœ</span></button>
            <button type="submit" name="sort_order" value="desc">ğŸ”½<span>ë‚´ë¦¼ì°¨ìˆœ</span></button>
            <button type="button" id="toggleBtn" class="toggle-columns-btn" onclick="toggleHiddenColumns()">ğŸ‘ï¸ ì‚¬ë²ˆ/ì´ë¦„ ìˆ¨ê¸°ê¸°</button>
        </form>
    </div>
    {% endif %}

    <div class="dashboard-table-wrapper table-wrapper">
        {{ table_html | safe }}
    </div>
</div>

<script>
function uncheckAll() {
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
}

function toggleHiddenColumns() {
    const sabuns = document.querySelectorAll('.sabun-col');
    const names = document.querySelectorAll('.name-col');
    const isHidden = sabuns.length > 0 && getComputedStyle(sabuns[0]).visibility === 'hidden';

    sabuns.forEach(el => el.classList.toggle('hidden-col'));
    names.forEach(el => el.classList.toggle('hidden-col'));

    const btn = document.getElementById('toggleBtn');
    btn.innerText = isHidden ? 'ğŸ‘ï¸ ì‚¬ë²ˆ/ì´ë¦„ ìˆ¨ê¸°ê¸°' : 'ğŸ‘ï¸ ì‚¬ë²ˆ/ì´ë¦„ ë³´ê¸°';

    updateStickyLefts();
    adjustTableMargin();
}

function updateStickyLefts() {
    const rows = document.querySelectorAll('.table tr');
    if (!rows.length) return;

    const headerRow = rows[0];
    const headers = headerRow.querySelectorAll('th');

    let left = 0;
    headers.forEach((th, i) => {
        if (th.style.position === 'sticky' || getComputedStyle(th).position === 'sticky') {
            th.style.left = left + 'px';
            rows.forEach(row => {
                const cell = row.children[i];
                if (cell) {
                    cell.style.left = left + 'px';
                }
            });
            left += th.offsetWidth;
        }
    });
}

function adjustTableMargin() {
    const firstVisibleCol = document.querySelector('.table th:not(.hidden-col)');
    const wrapper = document.querySelector('.table-wrapper');
    if (firstVisibleCol && wrapper) {
        const offset = firstVisibleCol.offsetLeft;
        wrapper.scrollLeft = offset;
    }
}

// âœ… ì¶”ê°€: í˜ì´ì§€ ë¡œë“œì‹œ ì‚¬ë²ˆ/ì´ë¦„ ì»¬ëŸ¼ì€ í•­ìƒ í‘œì‹œë˜ë„ë¡ ì„¤ì •
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll('.sabun-col, .name-col').forEach(el => {
        el.classList.remove('hidden-col');
    });
});
</script>

{% endblock %}
